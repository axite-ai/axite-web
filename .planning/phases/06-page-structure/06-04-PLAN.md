---
phase: 06-page-structure
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/ui/src/styles/variables.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Theme switching applies to full page (background, text, all elements)"
    - "Light and dark themes have distinct visual appearance"
  artifacts:
    - path: "lib/ui/src/styles/variables.css"
      provides: "CSS variables scoped to both .dark class and data-theme attribute"
  key_links:
    - from: "Tailwind dark mode selector"
      to: "CSS variable definitions"
      via: "[data-theme*='dark'] selector"
      pattern: "data-theme.*dark"
---

<objective>
Fix theme switching to apply CSS variables site-wide.

Purpose: Close Gap 2 from VERIFICATION.md - theme toggle changes state but CSS variables only respond to `.dark` class while Tailwind also expects `[data-theme*="dark"]` attribute.

Output: CSS variables that respond to both `.dark` class and `data-theme="dark"` attribute, enabling full theme cascade.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-page-structure/06-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add data-theme selector to CSS variables</name>
  <files>lib/ui/src/styles/variables.css</files>
  <action>
    The current variables.css defines dark mode variables under `.dark` selector only.
    The Tailwind config uses `darkMode: ['class', '[data-theme*="dark"]']` which means
    it checks for BOTH `.dark` class AND `[data-theme*="dark"]` attribute.

    The theme hook `useForceDeepDark` in `apps/www/lib/theme.utils.ts` sets:
    - `document.documentElement.setAttribute('data-theme', theme)`

    But the CSS variables only respond to `.dark` class, not `data-theme` attribute.

    Fix by adding the `[data-theme*="dark"]` selector alongside `.dark`:

    Current:
    ```css
    .dark {
      /* dark mode variables */
    }
    ```

    Change to:
    ```css
    .dark,
    [data-theme*="dark"] {
      /* dark mode variables */
    }
    ```

    This ensures CSS variables update when either:
    - `.dark` class is added (next-themes default behavior)
    - `data-theme="dark"` attribute is set (useForceDeepDark behavior)

    Additionally, ensure both systems work together by also handling light mode explicitly
    with a `[data-theme="light"]` selector that ensures :root values apply.
  </action>
  <verify>
    - Grep for `data-theme.*dark` in variables.css to confirm selector added
    - Check CSS syntax is valid (no missing commas or brackets)
    - Run TypeScript check to ensure no build issues: `cd apps/www && npx tsc --noEmit 2>&1 | head -10`
  </verify>
  <done>
    - variables.css dark mode section uses selector `.dark, [data-theme*="dark"]`
    - Both class-based and attribute-based dark mode triggers work
  </done>
</task>

</tasks>

<verification>
After completing the task:

1. Verify CSS selector added:
   ```bash
   grep -n "data-theme" lib/ui/src/styles/variables.css
   ```

2. Dev server starts and theme can be tested:
   ```bash
   cd apps/www && pnpm dev
   ```
   - Open browser at localhost:3000 (or assigned port)
   - Find theme toggle in footer
   - Switch between light/dark/system themes
   - Verify FULL page changes (background, text, not just logo/buttons)

3. Check browser DevTools:
   - Inspect html element
   - Verify `data-theme="dark"` or `data-theme="light"` attribute changes on toggle
   - Verify CSS variables update in computed styles
</verification>

<success_criteria>
- CSS variables defined for `[data-theme*="dark"]` selector
- Theme toggle changes entire page appearance (background, foreground, all elements)
- No CSS syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-page-structure/06-04-SUMMARY.md`
</output>
