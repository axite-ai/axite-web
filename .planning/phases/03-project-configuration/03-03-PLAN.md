---
phase: 03-project-configuration
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/www/next.config.mjs
  - apps/www/.env.example
autonomous: true

must_haves:
  truths:
    - "next.config.mjs is standalone (no transpilePackages for local lib/ packages)"
    - "next.config.mjs doesn't fail on missing Supabase-specific env vars"
    - "Sentry integration is disabled or stubbed (we're not using Supabase's Sentry)"
    - ".env.example documents all discovered environment variables"
    - "getAssetPrefix() function is callable without runtime errors"
  artifacts:
    - path: "apps/www/next.config.mjs"
      provides: "Standalone Next.js configuration"
      contains: "nextConfig"
    - path: "apps/www/.env.example"
      provides: "Environment variable documentation"
      contains: "NEXT_PUBLIC"
  key_links:
    - from: "apps/www/next.config.mjs"
      to: "apps/www/tailwind.config.js"
      via: "MDX/build pipeline"
      pattern: "withMDX"
    - from: "apps/www/next.config.mjs"
      to: "getAssetPrefix()"
      via: "assetPrefix config option"
      pattern: "assetPrefix.*getAssetPrefix"
---

<objective>
Clean Next.js configuration for standalone project - remove monorepo artifacts and Supabase-specific integrations.

Purpose: The current next.config.mjs has transpilePackages for external workspaces, Sentry integration for Supabase's project, and environment variable references that will fail. Need to make it work standalone.

Output: Clean next.config.mjs that works without monorepo context or Supabase infrastructure.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-project-configuration/03-RESEARCH.md
@.planning/phases/03-CONTEXT.md
@apps/www/next.config.mjs
@apps/www/.env.local.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean next.config.mjs of monorepo and Supabase-specific config</name>
  <files>apps/www/next.config.mjs</files>
  <action>
Make these changes to apps/www/next.config.mjs:

**1. Remove local packages from transpilePackages:**
Change:
```js
transpilePackages: [
  'ui',
  'ui-patterns',
  'common',
  'shared-data',
  'icons',
  'api-types',
  '@octokit/plugin-paginate-graphql',
],
```

To:
```js
transpilePackages: [
  // Local lib/ packages are already TypeScript, no transpilation needed
  // Only external packages that need it:
  '@octokit/plugin-paginate-graphql',
],
```

**2. Remove Sentry wrapper:**
Change the export from:
```js
export default withSentryConfig(configExport, { ... })
```

To just:
```js
export default configExport()
```

Remove the Sentry import:
```js
// REMOVE: import { withSentryConfig } from '@sentry/nextjs'
```

**3. Fix getAssetPrefix() to not fail on missing env vars:**
The function references `process.env.VERCEL_GIT_COMMIT_SHA` which may not exist.

Change:
```js
function getAssetPrefix() {
  if (process.env.FORCE_ASSET_CDN !== '1' && process.env.VERCEL_ENV !== 'production') {
    return undefined
  }
  if (process.env.FORCE_ASSET_CDN === '-1') {
    return undefined
  }
  return `https://frontend-assets.supabase.com/${process.env.SITE_NAME}/${process.env.VERCEL_GIT_COMMIT_SHA.substring(0, 12)}`
}
```

To:
```js
function getAssetPrefix() {
  // Disabled for standalone project - no CDN asset prefix
  return undefined
}
```

**4. Clean up Strict-Transport-Security header:**
The HSTS header references `NEXT_PUBLIC_IS_PLATFORM`. Simplify to always return empty (will be configured properly in production):
```js
{
  key: 'Strict-Transport-Security',
  value: '', // Configure in production deployment
},
```

**5. Keep everything else:**
- MDX configuration (withMDX) - needed for blog
- Bundle analyzer - useful for debugging
- Image remote patterns - needed for images
- Rewrites/redirects - preserve for compatibility
- Headers (security, caching) - preserve
- outputFileTracingExcludes - good optimization
  </action>
  <verify>
1. Node can parse and import the config module:
```bash
cd apps/www && node -e "import('./next.config.mjs').then(c => console.log('Next config loads OK'))"
```

2. Verify getAssetPrefix() is callable and doesn't crash:
```bash
cd apps/www && node -e "import('./next.config.mjs').then(m => { const config = typeof m.default === 'function' ? m.default() : m.default; console.log('Config export type:', typeof config); console.log('assetPrefix:', config.assetPrefix); console.log('getAssetPrefix callable: OK') })"
```

3. No Sentry import:
```bash
grep -c "@sentry/nextjs" apps/www/next.config.mjs && echo "FAIL: Sentry still imported" || echo "OK: No Sentry import"
```
  </verify>
  <done>next.config.mjs is standalone, doesn't reference Sentry or missing env vars, getAssetPrefix() is safe to call</done>
</task>

<task type="auto">
  <name>Task 2: Create .env.example with discovered environment variables</name>
  <files>apps/www/.env.example</files>
  <action>
Create apps/www/.env.example documenting all environment variables.

First, grep for env var usage in the codebase to find all referenced vars:
```bash
grep -rh "process\.env\." apps/www --include="*.ts" --include="*.tsx" --include="*.js" --include="*.mjs" |
  grep -oE "process\.env\.[A-Z_]+" | sort -u
```

Based on the existing .env.local.example and next.config.mjs analysis, create:

```bash
# ===========================================
# Axite Marketing Website - Environment Variables
# ===========================================
# Copy this file to .env.local and fill in values

# -------------------------------------------
# Build Configuration
# -------------------------------------------
# Set to 'true' to enable bundle analyzer
ANALYZE=false

# -------------------------------------------
# Vercel (auto-populated in Vercel deployments)
# -------------------------------------------
# These are automatically set by Vercel - no need to configure locally
# VERCEL=
# VERCEL_ENV=
# VERCEL_GIT_COMMIT_SHA=

# -------------------------------------------
# Feature Flags (optional)
# -------------------------------------------
# NEXT_PUBLIC_IS_PLATFORM=false

# -------------------------------------------
# External Services (configure as needed)
# -------------------------------------------
# Supabase (if using Supabase features - currently stubbed)
# NEXT_PUBLIC_SUPABASE_URL=
# NEXT_PUBLIC_SUPABASE_ANON_KEY=

# GitHub (for changelog feature)
# GITHUB_ACCESS_TOKEN=

# -------------------------------------------
# Analytics & Monitoring (optional)
# -------------------------------------------
# Add your analytics keys here when ready
# NEXT_PUBLIC_GA_ID=
```

Note: Many Supabase-specific vars from the original will be removed as we stub out Supabase functionality in later phases.
  </action>
  <verify>
File exists and documents key variables:
```bash
cat apps/www/.env.example | head -30
```
  </verify>
  <done>.env.example exists documenting environment variables for local development</done>
</task>

</tasks>

<verification>
1. `node -e "import('./next.config.mjs')"` succeeds in apps/www/
2. No `@sentry/nextjs` import in next.config.mjs
3. transpilePackages doesn't include local packages (ui, common, etc.)
4. .env.example exists and documents key environment variables
5. getAssetPrefix() doesn't reference undefined env vars and is callable
</verification>

<success_criteria>
- [ ] next.config.mjs has no @sentry/nextjs import
- [ ] next.config.mjs export is `configExport()` not `withSentryConfig(...)`
- [ ] transpilePackages only contains external packages (not ui, common, icons, etc.)
- [ ] getAssetPrefix() returns undefined (disabled for standalone)
- [ ] getAssetPrefix() is callable without runtime crash (verified with Node import test)
- [ ] next.config.mjs loads without Node errors
- [ ] .env.example exists with documented environment variables
</success_criteria>

<output>
After completion, create `.planning/phases/03-project-configuration/03-03-SUMMARY.md`
</output>
