---
phase: 02-package-inlining
plan: 03
type: execute
wave: 1
depends_on: ["02-02"]
files_modified:
  - apps/www/tsconfig.json
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "apps/www/tsconfig.json references lib/* instead of packages/*"
    - "TypeScript compilation in apps/www resolves inlined packages from lib/"
    - "No references to packages/ directory remain in apps/www/tsconfig.json"
  artifacts:
    - path: "apps/www/tsconfig.json"
      provides: "Path aliases pointing to lib/ packages"
      contains: '"@ui/*": ["./../../lib/ui/*"]'
  key_links:
    - from: "apps/www"
      to: "lib/*"
      via: "tsconfig path aliases"
      pattern: '"@ui/\\*":\\s*\\["\\./\\.\\./'
---

<objective>
Wire apps/www/tsconfig.json to use lib/ packages instead of packages/.

Purpose: Close Gap 1 from verification - apps/www currently cannot use the inlined packages because its tsconfig still points to packages/ui. After this plan, apps/www will import from lib/ packages via TypeScript path aliases.
Output: Updated apps/www/tsconfig.json with paths pointing to lib/*.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-package-inlining/02-VERIFICATION.md
@.planning/phases/02-package-inlining/02-02-SUMMARY.md
@apps/www/tsconfig.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update apps/www/tsconfig.json path aliases to use lib/</name>
  <files>apps/www/tsconfig.json</files>
  <action>
Update apps/www/tsconfig.json to reference lib/ packages instead of packages/.

Current problematic lines:
```json
"@ui/*": ["./../../packages/ui/src/*"]
```

This needs to become comprehensive path aliases matching the root tsconfig.json pattern, but with correct relative paths from apps/www/ to lib/.

Replace the paths section with aliases for all 7 inlined packages. The relative path from apps/www/ to lib/ is `./../../lib/`.

Write this updated apps/www/tsconfig.json:

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "contentlayer/generated": ["./.contentlayer/generated"],
      "~/*": ["./*"],
      "@/*": ["./*"],
      "ui": ["./../../lib/ui"],
      "ui/*": ["./../../lib/ui/*"],
      "common": ["./../../lib/common"],
      "common/*": ["./../../lib/common/*"],
      "shared-data": ["./../../lib/shared-data"],
      "shared-data/*": ["./../../lib/shared-data/*"],
      "config": ["./../../lib/config"],
      "config/*": ["./../../lib/config/*"],
      "icons": ["./../../lib/icons"],
      "icons/*": ["./../../lib/icons/*"],
      "ui-patterns": ["./../../lib/ui-patterns"],
      "ui-patterns/*": ["./../../lib/ui-patterns/*"],
      "api-types": ["./../../lib/api-types"],
      "api-types/*": ["./../../lib/api-types/*"]
    },
    "downlevelIteration": true,
    "target": "ES2021",
    "module": "esnext",
    "jsx": "preserve",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "noEmit": true,
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "exclude": ["node_modules", "supabase"],
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".contentlayer/generated"
  ]
}
```

Key changes:
1. Remove old `@ui/*` pointing to packages/ui
2. Add path aliases for all 7 packages (ui, common, icons, config, shared-data, ui-patterns, api-types)
3. Each package has both bare and subpath patterns
4. Remove include of packages/ui type definitions (no longer needed)
5. Keep contentlayer, ~/* and @/* aliases for backwards compatibility
  </action>
  <verify>
```bash
# Verify tsconfig.json is valid JSON
cd /Users/brad/Code/personal/axite/axite-new
cat apps/www/tsconfig.json | python3 -m json.tool > /dev/null && echo "Valid JSON"

# Verify all 7 path aliases exist and point to lib/
grep '"ui":' apps/www/tsconfig.json | grep 'lib/ui'
grep '"common":' apps/www/tsconfig.json | grep 'lib/common'
grep '"icons":' apps/www/tsconfig.json | grep 'lib/icons'
grep '"config":' apps/www/tsconfig.json | grep 'lib/config'
grep '"shared-data":' apps/www/tsconfig.json | grep 'lib/shared-data'
grep '"ui-patterns":' apps/www/tsconfig.json | grep 'lib/ui-patterns'
grep '"api-types":' apps/www/tsconfig.json | grep 'lib/api-types'

# Verify NO references to packages/ remain
grep -c 'packages/' apps/www/tsconfig.json && echo "ERROR: packages/ refs remain" || echo "Clean: no packages/ refs"
```
  </verify>
  <done>apps/www/tsconfig.json has path aliases pointing to lib/* for all 7 packages, no packages/ references</done>
</task>

<task type="auto">
  <name>Task 2: Verify TypeScript can resolve imports from apps/www</name>
  <files></files>
  <action>
Run TypeScript compiler from the apps/www directory to verify path aliases resolve correctly.

```bash
cd /Users/brad/Code/personal/axite/axite-new/apps/www
npx tsc --noEmit 2>&1 | head -100
```

Check specifically for module resolution errors on our inlined packages:
```bash
npx tsc --noEmit 2>&1 | grep -E "Cannot find module '(ui|common|icons|config|shared-data|ui-patterns|api-types)'" || echo "No module resolution errors for inlined packages"
```

Expected outcome:
- Many errors from Supabase-specific code (lib/posts, ~/lib/constants, etc.) - this is expected
- ZERO "Cannot find module" errors for our 7 inlined packages
- If module resolution errors occur for inlined packages, investigate and fix tsconfig paths

Note: We're NOT trying to achieve zero TypeScript errors yet - just verifying that the PATH ALIASING works.
  </action>
  <verify>
```bash
cd /Users/brad/Code/personal/axite/axite-new/apps/www

# This command should output nothing if path resolution works for inlined packages
npx tsc --noEmit 2>&1 | grep -E "Cannot find module '(ui|common|icons|config|shared-data|ui-patterns|api-types)'" | head -5

# If output is empty, path resolution is working
echo "If no output above, path resolution is working"
```
  </verify>
  <done>TypeScript in apps/www resolves all 7 inlined packages without "Cannot find module" errors</done>
</task>

</tasks>

<verification>
Gap closure verification:
```bash
cd /Users/brad/Code/personal/axite/axite-new

# 1. apps/www/tsconfig.json has lib/ paths
grep -E '"(ui|common|icons|config|shared-data|ui-patterns|api-types)":' apps/www/tsconfig.json | wc -l  # Should be 7

# 2. No packages/ references in apps/www/tsconfig.json
grep 'packages/' apps/www/tsconfig.json && echo "FAIL: packages/ refs" || echo "PASS: No packages/ refs"

# 3. TypeScript resolves inlined packages from apps/www
cd apps/www && npx tsc --noEmit 2>&1 | grep -c "Cannot find module '(ui|common|icons|config|shared-data|ui-patterns|api-types)'" || echo "PASS: Packages resolve"
```
</verification>

<success_criteria>
1. apps/www/tsconfig.json contains path aliases for all 7 packages pointing to lib/
2. No references to packages/ directory in apps/www/tsconfig.json
3. TypeScript compiler does NOT report "Cannot find module" for any inlined package when run from apps/www
4. Gap 1 from 02-VERIFICATION.md is closed
</success_criteria>

<output>
After completion, create `.planning/phases/02-package-inlining/02-03-SUMMARY.md`
</output>
