---
phase: 02-package-inlining
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - tsconfig.json
  - lib/icons/package.json
autonomous: true

must_haves:
  truths:
    - "TypeScript resolves bare imports like 'ui' and 'common' to lib/ directories"
    - "No 'Cannot find module' errors for inlined package imports"
    - "No file: protocol dependencies remain in lib/ package.json files"
  artifacts:
    - path: "tsconfig.json"
      provides: "Path aliases for all 7 packages"
      contains: '"ui": ["./lib/ui"]'
    - path: "lib/icons/package.json"
      provides: "Clean package.json without build-icons dependency"
  key_links:
    - from: "tsconfig.json paths"
      to: "lib/*"
      via: "TypeScript module resolution"
      pattern: '"ui":\\s*\\["\\./lib/ui"\\]'
---

<objective>
Configure TypeScript path aliases to resolve bare package imports and clean up monorepo-specific dependencies.

Purpose: Enable the codebase to import from packages using bare names (e.g., `from 'ui'`) without modifying 200+ import statements.
Output: Updated tsconfig.json with path aliases; cleaned package.json files in lib/.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-package-inlining/02-CONTEXT.md
@.planning/phases/02-package-inlining/02-RESEARCH.md
@packages/tsconfig/base.json
@packages/tsconfig/nextjs.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure tsconfig.json with inlined base and path aliases</name>
  <files>tsconfig.json</files>
  <action>
Replace the current minimal tsconfig.json with a complete configuration that:

1. Inlines the settings from packages/tsconfig/base.json and packages/tsconfig/nextjs.json (no more extends to external package)
2. Adds path aliases for all 7 inlined packages
3. Uses moduleResolution: "bundler" (modern Next.js standard)
4. Preserves existing @/* alias pattern

Write this tsconfig.json:

```json
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "compilerOptions": {
    "target": "ES2021",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "incremental": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "baseUrl": ".",
    "paths": {
      "ui": ["./lib/ui"],
      "ui/*": ["./lib/ui/*"],
      "common": ["./lib/common"],
      "common/*": ["./lib/common/*"],
      "shared-data": ["./lib/shared-data"],
      "shared-data/*": ["./lib/shared-data/*"],
      "config": ["./lib/config"],
      "config/*": ["./lib/config/*"],
      "icons": ["./lib/icons"],
      "icons/*": ["./lib/icons/*"],
      "ui-patterns": ["./lib/ui-patterns"],
      "ui-patterns/*": ["./lib/ui-patterns/*"],
      "api-types": ["./lib/api-types"],
      "api-types/*": ["./lib/api-types/*"],
      "@/*": ["./*"]
    },
    "plugins": [{ "name": "next" }]
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules", "packages"]
}
```

Key decisions:
- moduleResolution: "bundler" (not "node") - modern Next.js 13+ standard
- Both bare import ("ui") and subpath ("ui/*") patterns for each package
- packages/ excluded since we're using lib/ now
  </action>
  <verify>
```bash
# Verify tsconfig.json is valid JSON
cat tsconfig.json | python3 -m json.tool > /dev/null && echo "Valid JSON"

# Verify all 7 path aliases exist
grep -c '"ui":' tsconfig.json        # Should output 1
grep -c '"common":' tsconfig.json    # Should output 1
grep -c '"icons":' tsconfig.json     # Should output 1
grep -c '"config":' tsconfig.json    # Should output 1
grep -c '"shared-data":' tsconfig.json    # Should output 1
grep -c '"ui-patterns":' tsconfig.json    # Should output 1
grep -c '"api-types":' tsconfig.json      # Should output 1
```
  </verify>
  <done>tsconfig.json contains all 7 path aliases pointing to lib/ directories, uses moduleResolution: "bundler"</done>
</task>

<task type="auto">
  <name>Task 2: Clean up monorepo-specific dependencies in lib/ package.json files</name>
  <files>lib/icons/package.json</files>
  <action>
Clean up package.json files in lib/ that contain file: protocol dependencies (monorepo-specific).

Primary target: lib/icons/package.json
- Remove `@supabase/build-icons` dependency (file:../build-icons) - it's dev-only tooling for generating icons from SVGs
- The icons are already pre-built as TypeScript components, no build step needed

Read lib/icons/package.json and write an updated version:
- Remove the line: `"@supabase/build-icons": "file:../build-icons"`
- Keep all other dependencies (typescript, @types/react, react peer dep)

Also check other packages for file: dependencies:
```bash
grep -r '"file:' lib/*/package.json
```

If any other file: dependencies found, remove them as they reference monorepo paths that no longer exist.
  </action>
  <verify>
```bash
# Verify no file: protocol dependencies remain in any lib/ package.json
grep -r '"file:' lib/*/package.json && echo "ERROR: file: deps remain" || echo "Clean: no file: deps"

# Verify icons/package.json is valid JSON
cat lib/icons/package.json | python3 -m json.tool > /dev/null && echo "icons/package.json is valid JSON"
```
  </verify>
  <done>No file: protocol dependencies in any lib/*/package.json files</done>
</task>

<task type="auto">
  <name>Task 3: Verify TypeScript can resolve inlined package imports</name>
  <files></files>
  <action>
Run TypeScript compiler to verify path alias resolution works.

Note: We expect TypeScript errors from actual code issues (Supabase-specific modules), but we should NOT see "Cannot find module 'ui'" or similar errors for our inlined packages.

```bash
# Run TypeScript in noEmit mode and capture output
npx tsc --noEmit 2>&1 | head -100

# Specifically check for module resolution errors on our packages
npx tsc --noEmit 2>&1 | grep -E "Cannot find module '(ui|common|icons|config|shared-data|ui-patterns|api-types)'" || echo "No module resolution errors for inlined packages"
```

If there ARE module resolution errors for inlined packages:
1. Check the import path in the error
2. Verify the corresponding file exists in lib/
3. Check tsconfig.json has the correct path alias
4. Adjust tsconfig.json if needed

Expected outcome: TypeScript may report many errors (from Supabase-specific code), but NONE should be "Cannot find module" for our 7 inlined packages.
  </action>
  <verify>
```bash
# This command should output nothing (no matches) if path resolution is working
npx tsc --noEmit 2>&1 | grep -E "Cannot find module '(ui|common|icons|config|shared-data|ui-patterns|api-types)'" | head -5

# If output is empty, path resolution is working
```
  </verify>
  <done>TypeScript resolves all 7 inlined packages without "Cannot find module" errors</done>
</task>

</tasks>

<verification>
Phase 2 complete verification:
```bash
# 1. All packages exist in lib/
ls -d lib/config lib/icons lib/api-types lib/shared-data lib/common lib/ui lib/ui-patterns

# 2. tsconfig.json has all path aliases
grep -E '"(ui|common|icons|config|shared-data|ui-patterns|api-types)":' tsconfig.json | wc -l  # Should be 7

# 3. No file: dependencies remain
grep -r '"file:' lib/*/package.json && echo "FAIL" || echo "PASS: No file: deps"

# 4. TypeScript resolves inlined packages
npx tsc --noEmit 2>&1 | grep -c "Cannot find module '(ui|common|icons|config|shared-data|ui-patterns|api-types)'" || echo "PASS: Packages resolve"
```
</verification>

<success_criteria>
1. tsconfig.json contains path aliases for all 7 packages (ui, common, icons, config, shared-data, ui-patterns, api-types)
2. Each path alias has both bare ("ui") and subpath ("ui/*") patterns
3. No file: protocol dependencies in any lib/*/package.json
4. TypeScript compiler does NOT report "Cannot find module" for any of the 7 inlined packages
5. TypeScript may still report other errors (expected) - just not package resolution errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-package-inlining/02-02-SUMMARY.md`
</output>
